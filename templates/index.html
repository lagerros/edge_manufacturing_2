<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edge Field Manufacturing</title>
    <style>
      :root {
          --background-color: #1a1a1a;
          --font-color: #f0f0f0;
          --link-opacity: 0.8;
      }

      body {
          font-family: 'Courier New', Courier, monospace;
          background-color: var(--background-color);
          color: var(--font-color);
          margin: 0;
          padding: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
      }

      #company-name {
          position: absolute;
          top: 0;
          left: 0;
          margin: 20px;
          font-size: 24px;
      }

      form {
          box-sizing: border-box;
          color: var(--font-color);

          margin-top: 100px;
          display: flex;
          flex-direction: row;
          align-items: center;
      }

      input[type="text"] {
          box-sizing: border-box;
          padding: 5px;

          font-family: inherit;
          height: 35px;
          width: 300px;
          background-color: var(--background-color);
          border: 2px solid var(--font-color);
          margin-right: 15px

      }

      button[type="submit"] {
          height: 35px;
          font-family: inherit;
          background-color: var(--background-color);
          border: 2px solid var(--font-color);
          color: var(--font-color);
          transition: background-color 0.3s, color 0.3s; /* Smooth transition for background and text color */
      }

      button[type="submit"]:hover {
          cursor: pointer; /* Changes the cursor to a pointer */
          background-color: var(--font-color); /* Inverts the background color */
          color: var(--background-color); /* Inverts the text color */
      }

      #all-parts-link {
          margin-top: 20px;
          opacity: var(--link-opacity);
          color: var(--font-color);
      }

      #all-parts-link:hover {
          opacity: 1;
      }
      
      #partsTable {
          border-collapse: collapse;
          width: 100%;
          margin-top: 20px;
      }
      #partsTable, #partsTable th, #partsTable td {
          border: 1px solid var(--font-color);
          text-align: left;
          padding: 8px;
      }
      #partsTable th {
          background-color: var(--background-color);
          color: var(--font-color);
      }
      #partsTable td img {
          width: 50px;
          height: auto;
      }
      .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
      }

      .modal-content {
          background-color: #2a2a2a; /* Slightly brighter than --background-color */
          margin: 15% auto; /* 15% from the top and centered */
          padding: 20px;
          border: 1px solid var(--font-color); /* Border color */
          width: 80%; /* Could be more or less, depending on screen size */
      }

      .close-button {
          color: var(--font-color);
          float: right;
          font-size: 28px;
          font-weight: bold;
      }

      .close-button:hover,
      .close-button:focus {
          color: #000;
          text-decoration: none;
          cursor: pointer;
      }

      #modal-title {
          font-size: 24px; /* Larger font for the title */
      }

      .modal-body {
          margin: 10px 0;
          display: flex;
          align-items: center;
      }

      #modal-image {
          margin-right: 20px;
      }

      #modal-files {
          margin-top: 20px;
      }

      #modal-files ul {
          list-style-type: none;
      }

      #print-button {
          margin-top: 20px;
          width: 100%;
          padding: 10px;
          background-color: var(--font-color);
          color: var(--background-color);
          border: none;
          cursor: pointer;
      }
  </style>
    <script>

      document.addEventListener('DOMContentLoaded', function() {
        function displayResult(fileName) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<a href="/download/${fileName}" download><img src="icon.png" alt="Download File"/></a>`;
        }
        
        function fetchPartInfo(partId) {
          fetch(`/parts/${partId}`)
          .then(response => response.json())
          .then(part => {
              // Open a modal and display part info
              alert(`Name: ${part.name}\nDescription: ${part.description}`);
          });
        }
        
        fetch('/parts')
          .then(response => response.json())
          .then(parts => {
              const tableBody = document.getElementById('partsTable').getElementsByTagName('tbody')[0];
              parts.forEach(part => {
                  const row = tableBody.insertRow();
                  const nameCell = row.insertCell(0);
                  const descCell = row.insertCell(1);
                  const imgCell = row.insertCell(2);
                  const downloadCell = row.insertCell(3);

                  nameCell.textContent = part.name;
                if (part?.description) {
                  descCell.textContent = part.description.length > 50 ? part.description.substring(0, 47) + '...' : part.description;
                }
                if (part?.img_filename) {
                  imgCell.innerHTML = `<img src="/path/to/image/${part.img_filename}" alt="${part.name}" style="width:50px;height:auto;">`;
                }
                if (part?.stl_filename) {
                  downloadCell.innerHTML = `<a href="/download/${part.stl_filename}" download>Download</a>`
                }
                
                row.addEventListener('click', () => openModal(part));
                 
              });
          });
        
        document.querySelector('form').addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(this);
          fetch('/submit', {
            method: 'POST',
            body: formData,
          })
          .then(response => response.json())
          .then(data => {
            console.log("returned!"); 
            console.log(data); 
            displayResult(data.fileName);
            document.getElementById('status').innerText = 'Submitted'; // This text will be replaced by the download icon once the response is received
          })
          .catch(error => console.error('Error:', error));
        });
        
        // Open modal function
        function openModal(part) {
            document.getElementById('modal-title').textContent = part.name;
            document.getElementById('modal-description').textContent = part.description;
            document.getElementById('modal-image').src = `/path/to/image/${part.img_filename}`;
            let filesList = 'Files: <ul>';
            if (part.stl_filename) {
                filesList += `<li>${part.stl_filename}</li>`;
            }
            // Add more file types here if needed
            filesList += '</ul>';
            document.getElementById('modal-files').innerHTML = filesList;
            document.getElementById('modal').style.display = "block";
        }

        // Close modal when the user clicks on <span> (x)
        document.querySelector('.close-button').onclick = function() {
            document.getElementById('modal').style.display = "none";
        }

        // Close modal if the user clicks anywhere outside of it
        window.onclick = function(event) {
            if (event.target == document.getElementById('modal')) {
                document.getElementById('modal').style.display = "none";
            }
        }
      });
  

      
      document.getElementById('print-button').addEventListener('click', function() {
          window.print();
      });
    </script>
</head>
<body>
    
    <div id="company-name">edge</div>
      <form action="/submit" method="post">
          <input type="text" name="prompt" placeholder="Enter your design prompt">
          <button type="submit">Submit</button>
      </form>
      <a href="/parts" id="all-parts-link">All parts</a>
      <div id="status"></div>
      <div id="result"></div>
      <div id="partsTableContainer">
      <table id="partsTable">
          <thead>
              <tr>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Image</th>
                  <th>Download</th>
              </tr>
          </thead>
          <tbody>
              <!-- Parts will be dynamically inserted here -->
          </tbody>
      </table>
      
      <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 id="modal-title">Part Title</h2>
            <div class="modal-body">
                <img id="modal-image" src="" alt="Part Image" style="width:100px; height:auto;">
                <p id="modal-description">Part Description</p>
            </div>
            <div id="modal-files">Files:</div>
            <button id="print-button">Print</button>
        </div>
    </div>
  </div>

</body>
</html>