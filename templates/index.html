<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edge Field Manufacturing</title>
    <style>
      :root {
          --background-color: #1a1a1a;
          --font-color: #f0f0f0;
          --link-opacity: 0.8;
      }

      body {
          font-family: 'Courier New', Courier, monospace;
          background-color: var(--background-color);
          color: var(--font-color);
          margin: 0;
          padding: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
      }

      #company-name {
          position: absolute;
          top: 0;
          left: 0;
          margin: 20px;
          font-size: 24px;
      }

      form {
          box-sizing: border-box;
          color: var(--font-color);

          margin-top: 100px;
          display: flex;
          flex-direction: row;
          align-items: center;
      }

      input[type="text"] {
          box-sizing: border-box;
          padding: 5px;

          font-family: inherit;
          height: 35px;
          width: 300px;
          background-color: var(--background-color);
          border: 2px solid var(--font-color);
          margin-right: 15px

      }

      button[type="submit"] {
          height: 35px;
          font-family: inherit;
          background-color: var(--background-color);
          border: 2px solid var(--font-color);
          color: var(--font-color);
      }

      #all-parts-link {
          margin-top: 20px;
          opacity: var(--link-opacity);
          color: var(--font-color);
      }

      #all-parts-link:hover {
          opacity: 1;
      }
  </style>
    <script>

      document.addEventListener('DOMContentLoaded', function() {
        function displayResult(fileName) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<a href="/download/${fileName}" download><img src="icon.png" alt="Download File"/></a>`;
        }
        
        function fetchPartInfo(partId) {
          fetch(`/parts/${partId}`)
          .then(response => response.json())
          .then(part => {
              // Open a modal and display part info
              alert(`Name: ${part.name}\nDescription: ${part.description}`);
          });
        }
        
        fetch('/parts')
          .then(response => response.json())
          .then(parts => {
              const partsList = document.getElementById('partsList');
              parts.forEach(part => {
                  const partItem = document.createElement('li');
                  partItem.textContent = part.name;
                  partItem.onclick = () => fetchPartInfo(part.id);
                  partsList.appendChild(partItem);
              });
          });
        
        document.querySelector('form').addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(this);
          fetch('/submit', {
            method: 'POST',
            body: formData,
          })
          .then(response => response.json())
          .then(data => {
            console.log("returned!"); 
            console.log(data); 
            displayResult(data.fileName);
            document.getElementById('status').innerText = 'Submitted'; // This text will be replaced by the download icon once the response is received
          })
          .catch(error => console.error('Error:', error));
        });
      });
  
      function displayResult(fileName) {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = `<a href="/download/${fileName}" download><img src="icon.png" alt="Download File"/></a>`;
      }
    </script>
</head>
<body>
    
    <div id="company-name">edge</div>
    <form action="/submit" method="post">
        <input type="text" name="prompt" placeholder="Enter your design prompt">
        <button type="submit">Submit</button>
    </form>
    <a href="/parts" id="all-parts-link">All parts</a>
    <div id="status"></div>
    <div id="result"></div>
    <ul id="partsList"></ul>

</body>
</html>