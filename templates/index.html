<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edge Field Manufacturing</title>
    <style>
      :root {
          --background-color: #1a1a1a;
          --font-color: #f0f0f0;
          --link-opacity: 0.8;
      }

      body {
          font-family: 'Courier New', Courier, monospace;
          background-color: var(--background-color);
          color: var(--font-color);
          margin: 0;
          padding: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
      }

      #company-name {
          position: absolute;
          top: 0;
          left: 0;
          margin: 20px;
          font-size: 24px;
      }

      form {
          box-sizing: border-box;
          color: var(--font-color);

          margin-top: 100px;
          display: flex;
          flex-direction: row;
          align-items: center;
      }

      input[type="text"] {
          box-sizing: border-box;
          padding: 5px;

          font-family: inherit;
          height: 35px;
          width: 300px;
          background-color: var(--background-color);
          border: 2px solid var(--font-color);
          margin-right: 15px

      }

      button[type="submit"] {
          height: 35px;
          font-family: inherit;
          background-color: var(--background-color);
          border: 2px solid var(--font-color);
          color: var(--font-color);
          transition: background-color 0.3s, color 0.3s; /* Smooth transition for background and text color */
      }

      button[type="submit"]:hover {
          cursor: pointer; /* Changes the cursor to a pointer */
          background-color: var(--font-color); /* Inverts the background color */
          color: var(--background-color); /* Inverts the text color */
      }

      #all-parts-link {
          margin-top: 20px;
          opacity: var(--link-opacity);
          color: var(--font-color);
      }

      #all-parts-link:hover {
          opacity: 1;
      }
      
      #partsTable {
          border-collapse: collapse;
          width: 100%;
          margin-top: 20px;
      }
      #partsTable, #partsTable th, #partsTable td {
          border: 1px solid var(--font-color);
          text-align: left;
          padding: 8px;
      }
      #partsTable th {
          background-color: var(--background-color);
          color: var(--font-color);
      }
      #partsTable td img {
          width: 50px;
          height: auto;
      }
  </style>
    <script>

      document.addEventListener('DOMContentLoaded', function() {
        function displayResult(fileName) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<a href="/download/${fileName}" download><img src="icon.png" alt="Download File"/></a>`;
        }
        
        function fetchPartInfo(partId) {
          fetch(`/parts/${partId}`)
          .then(response => response.json())
          .then(part => {
              // Open a modal and display part info
              alert(`Name: ${part.name}\nDescription: ${part.description}`);
          });
        }
        
        fetch('/parts')
          .then(response => response.json())
          .then(parts => {
              const tableBody = document.getElementById('partsTable').getElementsByTagName('tbody')[0];
              parts.forEach(part => {
                  const row = tableBody.insertRow();
                  const nameCell = row.insertCell(0);
                  const descCell = row.insertCell(1);
                  const imgCell = row.insertCell(2);
                  const downloadCell = row.insertCell(3);

                  nameCell.textContent = part.name;
                if (part?.description) {
                  descCell.textContent = part.description.length > 50 ? part.description.substring(0, 47) + '...' : part.description;
                }
                if (part?.img_filename) {
                  imgCell.innerHTML = `<img src="/path/to/image/${part.img_filename}" alt="${part.name}" style="width:50px;height:auto;">`;
                }
                if (part?.stl_filename) {
                  downloadCell.innerHTML = `<a href="/download/${part.stl_filename}" download>Download</a>`
                }
                 
              });
          });
        
        document.querySelector('form').addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(this);
          fetch('/submit', {
            method: 'POST',
            body: formData,
          })
          .then(response => response.json())
          .then(data => {
            console.log("returned!"); 
            console.log(data); 
            displayResult(data.fileName);
            document.getElementById('status').innerText = 'Submitted'; // This text will be replaced by the download icon once the response is received
          })
          .catch(error => console.error('Error:', error));
        });
      });
  
      function displayResult(fileName) {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = `<a href="/download/${fileName}" download><img src="icon.png" alt="Download File"/></a>`;
      }
    </script>
</head>
<body>
    
    <div id="company-name">edge</div>
    <form action="/submit" method="post">
        <input type="text" name="prompt" placeholder="Enter your design prompt">
        <button type="submit">Submit</button>
    </form>
    <a href="/parts" id="all-parts-link">All parts</a>
    <div id="status"></div>
    <div id="result"></div>
    <div id="partsTableContainer">
      <table id="partsTable">
          <thead>
              <tr>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Image</th>
                  <th>Download</th>
              </tr>
          </thead>
          <tbody>
              <!-- Parts will be dynamically inserted here -->
          </tbody>
      </table>
  </div>

</body>
</html>